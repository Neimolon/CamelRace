<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>Client Page</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <!-- Program -->
        <script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
        
        
        
    </head>
    <body>
        <!--Game Screen -->
        <canvas id="ctx" width="500" height="500" style="border:1px solid black;"></canvas>

        <!--Cat Box -->
        <div id="chat-text" style="width: 500px;height: 100px;overflow-y: scroll;" >
            <div>Hello</div>
        </div>
        <form id="chat-form">
            <input id="chat-input" type="text" style="width: 500px;"  > 
        </form>
        
        
        
        <script> 
            
            var chatText  = document.getElementById("chat-text");
            var chatForm  = document.getElementById("chat-form");
            var chatInput = document.getElementById("chat-input");
            var ctx = document.getElementById("ctx").getContext("2d");
            ctx.font = "30px Arial";

    
            var socket = io(); 
            
            socket.on("newPosition", function(data){
                ctx.clearRect(0,0,500,500);
                for(var i = 0; i < data.player.length; i++){
                    ctx.fillText(data.player[i].number,data.player[i].x,data.player[i].y);
                }
                
                for(var i = 0; i < data.bullet.length; i++){
                    ctx.fillRect(data.bullet[i].x - 5,data.bullet[i].y - 5 , 10,10);
                }
                
            });
            
            socket.on("addToChat", function(data){
                chatText.innerHTML += "<div>" + data + "</div>";
            });
            
            socket.on("evalAnswer", function(data){
                console.log(data);
            });
            
            
            chatForm.onsubmit = function(e){
                e.preventDefault();
                if(chatInput.value[0] === '/')
                    socket.emit('evalServer', chatInput.value.slice(1));
                else
                    socket.emit("sendMsgToServer",chatInput.value);
                
                chatInput.value = "";
            }
            
            document.onkeydown = function(event){
                switch(event.keyCode){
                    
                    case 68: //d
                        socket.emit("KeyPress",{inputId:"right" ,state:true});
                    break;
                    case 65: //a
                        socket.emit("KeyPress",{inputId:"left",state:true});
                    break;
                    case 87: //w
                        socket.emit("KeyPress",{inputId:"up",state:true});
                    break;
                    case 83: //s
                        socket.emit("KeyPress",{inputId:"down",state:true});
                    break;
                }
            }

            document.onkeyup = function(event){
                switch(event.keyCode){
                    case 68: //d
                        socket.emit("KeyPress",{inputId:"right",state:false});
                    break;
                    case 65: //a
                        socket.emit("KeyPress",{inputId:"left",state:false});
                    break;
                    case 87: //w
                        socket.emit("KeyPress",{inputId:"up",state:false});
                    break;
                    case 83: //s
                        socket.emit("KeyPress",{inputId:"down",state:false});
                    break;
                }
            }
    
            document.onmousedown = function(event){
                console.log("Client:Click");
                socket.emit("KeyPress",{inputId:"attack",state:true});
            }
            
            document.onmouseup = function(event){
                socket.emit("KeyPress",{inputId:"attack",state:false});
            }

            document.onmousemove = function(event){
                var x = -250 + event.clientX -8;
                var y = -250 + event.clientY -8;
                var angle = Math.atan2(y,x) / Math.PI * 180;
                socket.emit("KeyPress",{inputId:"mouseAngle",state:angle});        
            }            
            
        </script>
        
        
    </body>
</html>
